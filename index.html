<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Mapa UE — Regiones de Chile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <style>
    html, body { margin:0; height:100%; background:#F1F1F1; font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial }
    #map { position:absolute; inset:0 }
    .mapboxgl-popup{ max-width:860px }
    .mapboxgl-popup-content{ border-radius:22px; padding:20px 22px; box-shadow:0 10px 30px rgba(0,0,0,.15) }
    .ux-popup h2{ margin:0 0 14px; font:800 24px/1.15 system-ui; color:#201245 }
    .ux-cards{ display:flex; gap:12px }
    .ux-card{ flex:1; border-radius:18px; text-align:center; padding:16px 10px; color:#201245 }
    .ux-card h3{ margin:0 0 6px; font:800 24px/1 system-ui }
    .ux-card p{ margin:0; font:14px/1.35 system-ui; color:#1e1e1e }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <script>
  mapboxgl.accessToken = 'pk.eyJ1IjoidmhpcnNjaGJlcmciLCJhIjoiY21lYmh4NDB4MG85bDJrcHdib21veGNubiJ9.WyoHoI8fXYX3VkEb42vKXg';

  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/light-v11',
    center: [-70.67, -33.45],
    zoom: 4.4,
    hash: true
  });

  // Botones de zoom arriba-izquierda (sin brújula)
  map.addControl(new mapboxgl.NavigationControl({ showCompass: false }), 'top-left');

  const T_MAN = ['to-number', ['get','manuales'], 0];
  const T_MAL = ['to-number', ['get','maleta'], 0];
  const T_MOB = ['to-number', ['get','mobilelab'], 0];
  const TOTAL  = ['+', T_MAN, ['+', T_MAL, T_MOB]];

  map.on('load', () => {
    map.addSource('regiones-centros', {
      type: 'geojson',
      data: 'https://azullecaros.github.io/mapa-ue/regiones_chile_centros.geojson'
    });

    // Círculos SIN borde
    map.addLayer({
      id: 'centros-circulos',
      type: 'circle',
      source: 'regiones-centros',
      paint: {
        'circle-color': '#E2D2F6',
        'circle-stroke-width': 0,
        'circle-radius': [
          'interpolate', ['linear'], TOTAL,
          0, 10,
          300, 16,
          800, 22,
          1600, 30,
          2600, 40
        ]
      }
    });

    // Número total centrado
    map.addLayer({
      id: 'centros-texto',
      type: 'symbol',
      source: 'regiones-centros',
      layout: {
        'text-field': ['to-string', TOTAL],
        'text-size': 13,
        'text-font': ['Open Sans Bold','Arial Unicode MS Bold'],
        'text-allow-overlap': true,
        'text-ignore-placement': true
      },
      paint: {
        'text-color': '#201245',
        'text-halo-color': '#FFFFFF',
        'text-halo-width': 0.6
      }
    });

    // Popup
    map.on('click', 'centros-circulos', (e) => {
      const p = e.features[0].properties;
      const html = `
        <div class="ux-popup">
          <h2>${p['región']}</h2>
          <div class="ux-cards">
            <div class="ux-card" style="background:#E2D2F6;">
              <h3>${Number(p['manuales']||0)}</h3><p>usuarios de <strong>Manuales</strong></p>
            </div>
            <div class="ux-card" style="background:#89ACDB;">
              <h3>${Number(p['maleta']||0)}</h3><p>usuarios de <strong>Maleta</strong></p>
            </div>
            <div class="ux-card" style="background:#A3D7DE;">
              <h3>${Number(p['mobilelab']||0)}</h3><p>usuarios de <strong>MobileLab</strong></p>
            </div>
          </div>
        </div>`;
      new mapboxgl.Popup({ offset:16, closeButton:true, maxWidth:'860px' })
        .setLngLat(e.lngLat).setHTML(html).addTo(map);
    });

    map.on('mouseenter','centros-circulos',()=>map.getCanvas().style.cursor='pointer');
    map.on('mouseleave','centros-circulos',()=>map.getCanvas().style.cursor='');
  });
  </script>
</body>
</html>



